@page "/"
@inject JokesClient jokesClient
@inject CommentClient commentClient

<PageTitle>Home</PageTitle>

<div class="m-5">
    <a class="btn btn-primary m-2" role="button" href="/editJoke" >New Joke</a>
    <a class="btn btn-secondary" role="button" href="/newComment">New Comment</a>
</div>

@if(jokes == null){
    <p><em>Loading....</em></p>
}
else{
    <table class="table table-striped-columns table-bordered table-hover">
        <thead class="table-dark">
            <th>ID</th>
            <th>Title</th>
            <th>Content</th>
            <th>Created</th>
            <th>Comments</th>
            <th>

            </th>
        </thead>
        <tbody>
            @foreach (var joke in jokes){
                <tr>
                    <td>@joke.Id</td>
                    <td>@joke.Title</td>
                    <td>@joke.Content</td>
                    <td>@joke.CreatedAt.ToString("dd.MM.yyyy")</td>
                    <td>
                        <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                           @joke.Comments.Count
                        </button>
                        <ul class="dropdown-menu">
                            @foreach(var comment in joke.Comments){
                                <li>
                                    <a class="dropdown-item" type="button">
                                    <a><span class="label label-default m-2">@comment.Title </span> </a>
                                    <a class="btn btn-light " role="button" href="@CommentUrl(comment.ID) "><i class="bi bi-pencil"></i></a>
                                    </a>
                                </li>
                            }
                        </ul>
                    </td>
                    <td>
                        <div>
                            <a class="btn btn-primary me-2" role="button" href="@JokeUrl(joke.Id)">
                                <i class="bi bi-pencil"></i>
                            </a>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
@code {
    private Joke[]? jokes;
    private Comment[]? comments;
    protected override void OnInitialized(){

        jokes = jokesClient.GetJokes();
        comments = commentClient.GetComments();
        jokesClient.PopulateComments(comments);
    }
    private static string JokeUrl(int id) => $"/editJoke/{id}";

    private static string CommentUrl(int id) => $"/editComment/{id}";
}    
